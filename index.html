<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>–ò–º–ø–æ—Å—Ç—ä—Ä ‚Äî –ü–ª—ä–∑–Ω–∏ –Ω–∞–¥–æ–ª—É</title>

  <style>
    :root {
      --bg1: #1e0a33;
      --bg2: #ff4f5e;
      --bg3: #ffb86c;
      --glass: rgba(9, 9, 15, 0.84);
      --accent: #ff5e7a;
      --accent-soft: rgba(255, 94, 122, .28);
      --accent2: #46e6ff;
      --accent2-soft: rgba(70, 230, 255, .22);
      --muted: rgba(255,255,255,.78);
      --white: #ffffff;
      --radius-xl: 28px;
      --radius-lg: 22px;
      --radius-md: 16px;
      --radius-pill: 999px;
      --shadow-soft: 0 16px 40px rgba(0,0,0,.40);
      --shadow-card: 0 22px 60px rgba(0,0,0,.55);
      --safe-top: env(safe-area-inset-top);
      --safe-bottom: env(safe-area-inset-bottom);
      --transition-fast: .18s ease-out;
      --transition-med: .26s cubic-bezier(.22,.7,.25,1);
      --blur: 16px;
      --font-ui: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
      --card-height: 440px;
      --panel-height: 190px;
    }

    * {
      box-sizing: border-box;
    }

    html, body {
      margin: 0;
      height: 100%;
    }

    body {
      font-family: var(--font-ui);
      -webkit-font-smoothing: antialiased;
      -webkit-text-size-adjust: 100%;
      -webkit-user-select: none;
      user-select: none;
      -webkit-tap-highlight-color: transparent;
      overscroll-behavior-y: none;
      color: var(--white);
      background: radial-gradient(circle at top left, var(--bg3) 0, transparent 40%),
                  radial-gradient(circle at top right, var(--bg2) 0, transparent 40%),
                  radial-gradient(circle at bottom, #141111 0, #05040a 72%);
      background-attachment: fixed;
      position: relative;
      overflow: hidden;
    }

    /* Animated gradient veil */
    body::before {
      content: "";
      position: fixed;
      inset: -40px;
      pointer-events: none;
      background:
        radial-gradient(circle at 10% 0%, rgba(255,255,255,0.07) 0, transparent 55%),
        radial-gradient(circle at 90% 0%, rgba(255,94,122,0.08) 0, transparent 55%);
      mix-blend-mode: screen;
      opacity: .75;
      animation: glowShift 16s ease-in-out infinite alternate;
      z-index: -1;
    }

    /* Soft moving particles */
    body::after {
      content: "";
      position: fixed;
      inset: -40px;
      pointer-events: none;
      background-image:
        radial-gradient(circle, rgba(255,255,255,0.11) 0, transparent 55%),
        radial-gradient(circle, rgba(255,94,122,0.12) 0, transparent 52%);
      background-size: 260px 260px, 220px 220px;
      background-repeat: no-repeat;
      background-position: 12% 16%, 86% 40%;
      filter: blur(4px);
      opacity: .16;
      animation: floatDots 22s linear infinite alternate;
      z-index: -1;
    }

    @keyframes glowShift {
      0% {
        transform: translate3d(0,0,0);
        opacity: .7;
      }
      100% {
        transform: translate3d(0,18px,0);
        opacity: 1;
      }
    }

    @keyframes floatDots {
      0% {
        transform: translate3d(0,0,0) scale(1);
      }
      100% {
        transform: translate3d(0,-22px,0) scale(1.06);
      }
    }

    @media (prefers-reduced-motion: reduce) {
      body::before,
      body::after {
        animation: none;
      }
    }

    .container {
      width: 100%;
      max-width: 430px;
      margin: 0 auto;
      min-height: 100%;
      display: grid;
      grid-template-rows: auto 1fr auto;
      padding: calc(10px + var(--safe-top)) 16px calc(18px + var(--safe-bottom));
      position: relative;
      z-index: 1;
    }

    /* Glass top bar */

    .topbar {
      position: sticky;
      top: 0;
      z-index: 20;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 8px 10px 10px;
      margin-bottom: 6px;
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      background: radial-gradient(circle at top, rgba(255,255,255,.03), transparent);
    }

    .topbar-inner {
      flex: 1;
      max-width: 430px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
      padding: 7px 12px;
      border-radius: var(--radius-pill);
      background: linear-gradient(135deg, rgba(255,255,255,.05), rgba(5,5,10,.9));
      box-shadow: 0 9px 24px rgba(0,0,0,.45);
      border: 1px solid rgba(255,255,255,.12);
      gap: 8px;
    }

    .clock {
      position: absolute;
      left: 14px;
      font-size: 12px;
      font-weight: 600;
      color: var(--muted);
    }

    .topbar-title {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 0;
    }

    .topbar-title span:nth-child(1) {
      font-size: 13px;
      text-transform: uppercase;
      letter-spacing: .18em;
      color: var(--accent2);
      opacity: .96;
    }

    .topbar-title span:nth-child(2) {
      font-size: 17px;
      font-weight: 800;
      letter-spacing: .08em;
    }

    .topbar-pill {
      position: absolute;
      right: 12px;
      display: flex;
      align-items: center;
      gap: 3px;
      padding: 3px 8px;
      border-radius: 999px;
      background: rgba(255,255,255,.04);
      border: 1px solid rgba(255,255,255,.10);
      font-size: 9px;
      color: var(--muted);
    }

    .topbar-pill-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      background: #3cff7c;
      box-shadow: 0 0 8px #3cff7c;
      animation: pulseDot 1.8s ease-in-out infinite;
    }

    @keyframes pulseDot {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.35); opacity: .55; }
    }

    .close {
      display: none; /* (optional) keep space for native chrome, but not needed here */
    }

    /* Screens */

    .screen {
      display: none;
      animation: fadeIn .26s var(--transition-med);
    }

    .screen.active {
      display: block;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(8px); }
      to   { opacity: 1; transform: translateY(0); }
    }

    /* Glass blocks */

    .block {
      background: radial-gradient(circle at top, rgba(255,255,255,.06), transparent)
                  ,var(--glass);
      border-radius: var(--radius-xl);
      padding: 16px 14px 14px;
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: var(--shadow-soft);
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      position: relative;
      overflow: hidden;
    }

    .block::before {
      content: "";
      position: absolute;
      top: -40px;
      right: -20px;
      width: 90px;
      height: 90px;
      border-radius: 999px;
      background: radial-gradient(circle, var(--accent-soft), transparent);
      opacity: .8;
      pointer-events: none;
    }

    .block h3 {
      margin: 3px 0 6px;
      font-size: 18px;
      font-weight: 800;
      letter-spacing: .03em;
    }

    .block-label {
      font-size: 12px;
      color: var(--muted);
      text-transform: uppercase;
      letter-spacing: .16em;
      margin-top: 4px;
      margin-bottom: 4px;
    }

    .center {
      text-align: center;
    }

    .hint {
      color: var(--muted);
      font-size: 11px;
      margin: 8px 3px 0;
    }

    /* Controls */

    .controls {
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      margin: 8px 0 4px;
      flex-wrap: nowrap;
    }

    .step {
      width: 42px;
      height: 42px;
      border-radius: var(--radius-md);
      border: 1px solid rgba(255,255,255,.25);
      background: radial-gradient(circle at 30% 0%, rgba(255,255,255,.12), transparent),
                  rgba(4,4,10,.96);
      color: var(--white);
      font-weight: 800;
      font-size: 22px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      box-shadow: 0 10px 22px rgba(0,0,0,.65);
      transition: transform var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), border-color var(--transition-fast);
    }

    .step:active {
      transform: translateY(1px) scale(.96);
      box-shadow: 0 4px 12px rgba(0,0,0,.7);
      background: rgba(255,94,122,.26);
      border-color: var(--accent);
    }

    .value {
      flex: 1;
      min-width: 90px;
      height: 42px;
      border-radius: 18px;
      background: radial-gradient(circle at top, rgba(255,255,255,.05), transparent),
                  rgba(4,4,10,.98);
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 800;
      font-size: 17px;
      border: 1px solid rgba(255,255,255,.14);
      box-shadow: 0 8px 20px rgba(0,0,0,.5);
    }

    /* Primary buttons */

    .primary {
      appearance: none;
      border: none;
      border-radius: var(--radius-pill);
      padding: 13px 20px;
      font-weight: 800;
      font-size: 14px;
      letter-spacing: .04em;
      text-transform: uppercase;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 6px;
      cursor: pointer;
      background: radial-gradient(circle at 0 0, rgba(255,255,255,.14), transparent),
                  linear-gradient(135deg, var(--accent), #ff9b6d);
      color: #050308;
      box-shadow: 0 16px 40px rgba(0,0,0,.72);
      transition: transform var(--transition-med), box-shadow var(--transition-med), background var(--transition-med), opacity var(--transition-fast);
      position: relative;
      overflow: hidden;
    }

    .primary span.icon {
      font-size: 16px;
      transform-origin: center;
      transition: transform var(--transition-fast);
    }

    .primary:hover span.icon {
      transform: translateX(2px);
    }

    .primary:active {
      transform: translateY(2px) scale(.97);
      box-shadow: 0 8px 20px rgba(0,0,0,.9);
    }

    .primary.alt {
      background: rgba(8,8,14,.98);
      color: var(--muted);
      box-shadow: 0 10px 28px rgba(0,0,0,.9);
      border: 1px solid rgba(255,255,255,.16);
      text-transform: none;
      letter-spacing: .01em;
      font-size: 13px;
    }

    .primary.alt span.icon {
      transform: none;
    }

    /* Names */

    .names {
      display: flex;
      flex-direction: column;
      gap: 7px;
      margin-top: 8px;
      max-height: 58vh;
      overflow-y: auto;
      padding-right: 4px;
    }

    .name-row {
      display: flex;
      gap: 6px;
      align-items: center;
    }

    .name-index {
      width: 20px;
      text-align: right;
      font-size: 10px;
      color: var(--accent2);
      opacity: .85;
    }

    .input {
      flex: 1;
      padding: 10px 11px;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
      background: radial-gradient(circle at 0 0, rgba(255,255,255,.04), transparent),
                  rgba(3,4,10,.98);
      color: var(--white);
      font-size: 13px;
      outline: none;
      box-shadow: 0 8px 20px rgba(0,0,0,.55);
      transition: border-color var(--transition-fast), box-shadow var(--transition-fast), background var(--transition-fast), transform var(--transition-fast);
    }

    .input::placeholder {
      color: rgba(255,255,255,.28);
    }

    .input:focus {
      border-color: var(--accent2);
      box-shadow: 0 10px 26px rgba(0,0,0,.75);
      transform: translateY(-1px);
    }

    /* Reveal screen */

    .reveal-wrap {
      position: relative;
      height: 72vh;
      min-height: 520px;
      max-height: 720px;
      margin: 10px auto 6px;
    }

    .word-panel {
      position: absolute;
      left: 0;
      right: 0;
      top: 0;
      height: var(--panel-height);
      padding: 16px 16px 12px;
      border-radius: var(--radius-xl);
      background:
        radial-gradient(circle at 0 0, rgba(255,255,255,.09), transparent),
        radial-gradient(circle at 100% 0, rgba(70,230,255,.12), transparent),
        rgba(6,6,12,.98);
      box-shadow: var(--shadow-card);
      display: flex;
      flex-direction: column;
      justify-content: flex-start;
      align-items: flex-start;
      gap: 6px;
      border: 1px solid rgba(255,255,255,.16);
      overflow: hidden;
      backdrop-filter: blur(var(--blur));
      -webkit-backdrop-filter: blur(var(--blur));
      z-index: 1;
    }

    .word-label {
      font-size: 10px;
      text-transform: uppercase;
      letter-spacing: .18em;
      color: var(--accent2);
      opacity: .9;
    }

    .word-panel h1 {
      margin: 0;
      font-size: clamp(24px, 6.6vw, 34px);
      font-weight: 900;
      letter-spacing: .08em;
    }

    .word-sub {
      font-size: 11px;
      color: var(--muted);
    }

    .reveal-progress {
      margin-left: auto;
      display: inline-flex;
      gap: 3px;
      align-items: center;
    }

    .dot {
      width: 6px;
      height: 6px;
      border-radius: 999px;
      background: rgba(255,255,255,.16);
      transition: all .22s ease-out;
      transform-origin: center;
    }

    .dot.active {
      width: 14px;
      background: var(--accent);
      box-shadow: 0 0 8px var(--accent);
      transform: translateY(-1px);
    }

    .dot.done {
      background: rgba(70,230,255,.9);
      box-shadow: 0 0 8px rgba(70,230,255,.95);
    }

    .card {
      position: absolute;
      left: 0;
      right: 0;
      top: 40px;
      margin: 0 auto;
      width: 100%;
      max-width: 360px;
      height: var(--card-height);
      border-radius: 32px;
      border: 3px solid rgba(255,255,255,.96);
      background:
        radial-gradient(circle at top left, rgba(255,255,255,.22), transparent 70%),
        linear-gradient(180deg, #ff9b6d, #ff4f5e);
      box-shadow: var(--shadow-card);
      overflow: hidden;
      touch-action: none;
      cursor: grab;
      will-change: transform;
      z-index: 2;
      transform-origin: center top;
      transition: box-shadow var(--transition-fast), border-color var(--transition-fast), transform .22s ease-out;
    }

    .card:active {
      cursor: grabbing;
    }

    .card-inner {
      position: absolute;
      inset: 0;
      padding: 18px 18px 18px;
      display: flex;
      flex-direction: column;
      align-items: center;
    }

    .player-name {
      margin-top: 4px;
      font-size: clamp(22px, 7vw, 32px);
      font-weight: 900;
      text-align: center;
      color: #ffffff;
      text-shadow: 0 4px 16px rgba(0,0,0,.42);
    }

    .avatar {
      margin-top: 42px;
      width: 210px;
      height: 170px;
      border-radius: 26px;
      background:
        radial-gradient(circle at 50% 0%, rgba(255,255,255,.42), transparent 70%),
        radial-gradient(circle at 10% 80%, rgba(255,255,255,.14), transparent 80%),
        radial-gradient(circle at 86% 40%, rgba(70,230,255,.26), transparent 70%),
        linear-gradient(145deg, #2b163e, #13091c);
      position: relative;
      box-shadow: inset 0 -20px 40px rgba(0,0,0,.6), 0 16px 40px rgba(0,0,0,.7);
      overflow: hidden;
    }

    .avatar::before,
    .avatar::after {
      content: "";
      position: absolute;
      border-radius: 999px;
      border: 2px solid rgba(255,255,255,.2);
      opacity: .58;
    }

    .avatar::before {
      width: 64px;
      height: 36px;
      left: 16px;
      bottom: 18px;
      border-radius: 18px;
      border-color: rgba(255,255,255,.24);
    }

    .avatar::after {
      width: 26px;
      height: 26px;
      right: 18px;
      top: 18px;
      border-color: rgba(70,230,255,.6);
      box-shadow: 0 0 14px rgba(70,230,255,.9);
    }

    .hint-row {
      margin-top: auto;
      margin-bottom: 8px;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 6px;
      font-weight: 700;
      font-size: 13px;
      color: #ffffff;
      text-shadow: 0 3px 10px rgba(0,0,0,.32);
    }

    .arrow {
      width: 20px;
      height: 20px;
      border: 3px solid #fff;
      border-right: 0;
      border-top: 0;
      transform: rotate(-45deg);
      animation: arrowBob 1.2s ease-in-out infinite;
    }

    @keyframes arrowBob {
      0% { transform: translateY(0) rotate(-45deg); }
      50% { transform: translateY(6px) rotate(-45deg); }
      100% { transform: translateY(0) rotate(-45deg); }
    }

    .footer {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 8px;
      margin-top: 4px;
    }

    .btn {
      display: none;
      margin: 0 auto;
    }

    .btn.show {
      display: inline-flex;
    }

    .pass {
      font-size: 11px;
      color: var(--muted);
    }

    /* End screen */

    #end .emoji {
      font-size: 24px;
      margin-right: 4px;
    }

    #end .title {
      font-weight: 900;
      font-size: 20px;
      margin: 4px 0 4px;
    }

    /* Confetti canvas */

    #confettiCanvas {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 999;
    }
  </style>
</head>

<body>
<canvas id="confettiCanvas"></canvas>

<div class="container">
  <header class="topbar">
    <div class="topbar-inner">
      <div class="clock" id="clock"></div>
      <div class="topbar-title">
        <span>secret word party</span>
        <span>–ò–º–ø–æ—Å—Ç—ä—Ä</span>
      </div>
      <div class="topbar-pill">
        <div class="topbar-pill-dot"></div>
        <div>round ready</div>
      </div>
    </div>
  </header>

  <!-- SETUP -->
  <section id="setup" class="screen active">
    <div class="block center">
      <div class="block-label">–°—Ç—ä–ø–∫–∞ 1</div>
      <h3>–ù–æ–≤–∞ –∏–≥—Ä–∞</h3>

      <div class="block-label">–ò–≥—Ä–∞—á–∏—Ç–µ</div>
      <div class="controls">
        <button class="step" data-step="players" data-delta="-1">‚Äì</button>
        <div id="playersVal" class="value">5</div>
        <button class="step" data-step="players" data-delta="1">+</button>
      </div>

      <div class="block-label">–ò–º–ø–æ—Å—Ç—ä—Ä–∏</div>
      <div class="controls">
        <button class="step" data-step="imps" data-delta="-1">‚Äì</button>
        <div id="impsVal" class="value">1</div>
        <button class="step" data-step="imps" data-delta="1">+</button>
      </div>

      <p class="hint">–ò–≥—Ä–∞—Ç–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–µ–ø–æ—Ä—ä—á–≤–∞ –æ–ø—Ç–∏–º–∞–ª–Ω–∏—è –±—Ä–æ–π –∏–º–ø–æ—Å—Ç—ä—Ä–∏. –ú–æ–∂–µ—à –¥–∞ –≥–æ –ø—Ä–æ–º–µ–Ω–∏—à –ø–æ –≤—Å—è–∫–æ –≤—Ä–µ–º–µ.</p>

      <div style="margin-top:14px;">
        <button id="goNames" class="primary">
          <span>–ü—Ä–æ–¥—ä–ª–∂–∏ –∫—ä–º –∏–º–µ–Ω–∞—Ç–∞</span>
          <span class="icon">‚Ä∫</span>
        </button>
      </div>
    </div>
  </section>

  <!-- NAMES -->
  <section id="names" class="screen">
    <div class="block">
      <div class="block-label">–°—Ç—ä–ø–∫–∞ 2</div>
      <h3 class="center">–ò–º–µ–Ω–∞ –Ω–∞ –∏–≥—Ä–∞—á–∏—Ç–µ</h3>

      <div id="namesList" class="names"></div>

      <div class="controls" style="justify-content:center; margin-top:12px;">
        <button id="startGame" class="primary">
          <span>–°—Ç–∞—Ä—Ç –Ω–∞ —Ä—É–Ω–¥–∞</span>
          <span class="icon">‚ñ∂</span>
        </button>
        <button id="backSetup" class="primary alt">
          <span class="icon">‚Üê</span>
          <span>–ù–∞–∑–∞–¥</span>
        </button>
      </div>

      <p class="hint">–û—Å—Ç–∞–≤–∏ –ø—Ä–∞–∑–Ω–æ –∑–∞ ‚Äû–ò–≥—Ä–∞—á 1‚Äú, ‚Äû–ò–≥—Ä–∞—á 2‚Äú‚Ä¶ –ò–º–µ–Ω–∞—Ç–∞ –Ω–µ —Å–µ –ø–æ–∫–∞–∑–≤–∞—Ç –µ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ ‚Äî –≤—Å–µ–∫–∏ –≤–∏–∂–¥–∞ —Å–∞–º–æ —Å–≤–æ—è—Ç–∞ –∫–∞—Ä—Ç–∞.</p>
    </div>
  </section>

  <!-- REVEAL -->
  <section id="reveal" class="screen" aria-label="–ü–ª—ä–∑–Ω–∏ –Ω–∞–¥–æ–ª—É, –∑–∞ –¥–∞ –≤–∏–¥–∏—à —Ä–æ–ª—è—Ç–∞/–¥—É–º–∞—Ç–∞">
    <div class="reveal-wrap" id="wrap">
      <div id="panel" class="word-panel">
        <div class="word-label">–¢–∞–π–Ω–∞ –¥—É–º–∞ / —Ä–æ–ª—è</div>
        <h1 id="word">–î–£–ú–ê</h1>
        <div class="word-sub">–ü–ª—ä–∑–Ω–∏ –∫–∞—Ä—Ç–∞—Ç–∞ –Ω–∞–¥–æ–ª—É, —Å–∞–º–æ –∫–æ–≥–∞—Ç–æ —Å–∏ —Å–∏–≥—É—Ä–µ–Ω, —á–µ –Ω–∏–∫–æ–π –¥—Ä—É–≥ –Ω–µ –≥–ª–µ–¥–∞.</div>
        <div class="reveal-progress" id="dots"></div>
      </div>

      <div id="card" class="card" role="button" tabindex="0" aria-describedby="panel">
        <div class="card-inner">
          <div class="player-name" id="pname">–ò–≥—Ä–∞—á</div>
          <div class="avatar" aria-hidden="true"></div>
          <div class="hint-row">
            <div class="arrow" aria-hidden="true"></div>
            <div>–ü–ª—ä–∑–Ω–∏ –Ω–∞–¥–æ–ª—É, –∑–∞ –¥–∞ —Ä–∞–∑–∫—Ä–∏–µ—à</div>
            <div style="font-size:10px; opacity:.9;">–°–ª–µ–¥ —Ç–æ–≤–∞ –ø–æ–¥–∞–π —Ç–µ–ª–µ—Ñ–æ–Ω–∞ –Ω–∞—Ç–∞—Ç—ä–∫</div>
          </div>
        </div>
      </div>
    </div>

    <div class="footer">
      <button id="next" class="primary btn">
        <span>–°–ª–µ–¥–≤–∞—â –∏–≥—Ä–∞—á</span>
        <span class="icon">‚Ä∫</span>
      </button>
      <div class="pass">–ü—Ä–µ–¥–∞–π —É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ—Ç–æ –Ω–∞ —Å–ª–µ–¥–≤–∞—â–∏—è –∏–≥—Ä–∞—á, –±–µ–∑ –¥–∞ –∏–∑–¥–∞–≤–∞—à —Ä–æ–ª—è—Ç–∞ —Å–∏.</div>
    </div>
  </section>

  <!-- END -->
  <section id="end" class="screen">
    <div class="center">
      <div class="title"><span class="emoji">üéâ</span>–í—Å–∏—á–∫–∏ –≤–∏–¥—è—Ö–∞ —Ä–æ–ª–∏—Ç–µ —Å–∏</div>
      <p class="hint">–ó–∞–ø–æ—á–Ω–µ—Ç–µ –¥–∏—Å–∫—É—Å–∏—è—Ç–∞, –æ–±–≤–∏–Ω–µ–Ω–∏—è—Ç–∞ –∏ —Ö–∞–æ—Å–∞. –ü–æ—Å–ª–µ –º–æ–∂–µ—à –¥–∞ –ø—É—Å–Ω–µ—à –Ω–æ–≤–∞ —Ä—É–Ω–¥–∞ –∏–ª–∏ –¥–∞ –ø—Ä–æ–º–µ–Ω–∏—à –∏–≥—Ä–∞—á–∏—Ç–µ.</p>
    </div>

    <div class="controls" style="justify-content:center; margin-top:14px;">
      <button id="again" class="primary">
        <span>–ù–æ–≤–∞ —Ä—É–Ω–¥–∞ (—Å—ä—â–∏—Ç–µ –∏–≥—Ä–∞—á–∏)</span>
        <span class="icon">‚ü≥</span>
      </button>
      <button id="toSetup" class="primary alt">
        <span class="icon">‚öô</span>
        <span>–ù–∞—Å—Ç—Ä–æ–π–∫–∏</span>
      </button>
    </div>
  </section>
</div>

<script>
  // ---------- DATA ----------
  const WORDS = [
    '–í—É–ª–∫–∞–Ω','–ß–∞–¥—ä—Ä','–†–∞–Ω–∏—Ü–∞','–§–∞—Ä','–§–µ–Ω–µ—Ä','–û–≥–ª–µ–¥–∞–ª–æ','–¢–µ–ª–µ—Å–∫–æ–ø',
    '–ü–∞–ª–∞—á–∏–Ω–∫–∏','–ö–æ–º–ø–∞—Å','–†–∞–∫–µ—Ç–∞','–ö–∏–Ω–æ','–ü–∏–Ω–≥–≤–∏–Ω','–ü—É—Å—Ç–∏–Ω—è','–ü–∏—Ü–∞',
    '–•–µ–ª–∏–∫–æ–ø—Ç–µ—Ä','–ö–æ—Ä–∞–±','–õ–∞–≤–∏–Ω–∞','–î—Ä–∞–∫–æ–Ω','–ü–∏–∞–Ω–æ','–ü–ª–∞–∂'
  ];

  let playersCount = 5;
  let impostors = 1;
  let players = [];
  let secretWord = '';
  let impIdx = [];
  let current = 0;

  // ---------- ELEMENTS ----------
  const screens = mapEls('#setup','#names','#reveal','#end');
  const playersVal = qs('#playersVal');
  const impsVal = qs('#impsVal');
  const goNamesBtn = qs('#goNames');
  const startGameBtn = qs('#startGame');
  const backSetupBtn = qs('#backSetup');
  const namesList = qs('#namesList');
  const wrap = qs('#wrap');
  const card = qs('#card');
  const panel = qs('#panel');
  const pname = qs('#pname');
  const wordEl = qs('#word');
  const nextBtn = qs('#next');
  const againBtn = qs('#again');
  const toSetupBtn = qs('#toSetup');
  const dotsEl = qs('#dots');
  const confettiCanvas = qs('#confettiCanvas');

  // ---------- CLOCK ----------
  (function setClock() {
    const el = qs('#clock');
    function pad(n) { return (n < 10 ? '0' : '') + n; }
    const d = new Date();
    el.textContent = pad(d.getHours()) + ':' + pad(d.getMinutes());
  })();

  // ---------- HELPERS ----------
  function qs(sel){ return document.querySelector(sel); }
  function mapEls(...sel) {
    const o = {};
    sel.forEach(s => o[s.slice(1)] = qs(s));
    return o;
  }
  function onAll(sel,ev,cb){
    document.querySelectorAll(sel).forEach(n => n.addEventListener(ev, () => cb(n)));
  }
  function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }

  function recommendImpostors(n){
    if(n <= 5) return 1;
    if(n <= 8) return 2;
    if(n <= 12) return 3;
    if(n <= 18) return 4;
    return Math.floor(n / 4);
  }

  function pickUnique(n,k){
    const arr = Array.from({length:n},(_,i)=>i);
    for(let i = arr.length - 1; i > 0; i--){
      const j = (Math.random() * (i + 1)) | 0;
      [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr.slice(0, k).sort((a,b)=>a-b);
  }

  function show(key){
    Object.values(screens).forEach(s => s.classList.remove('active'));
    screens[key].classList.add('active');
  }

  function haptic(pattern){
    if(navigator.vibrate) {
      navigator.vibrate(pattern);
    }
  }

  // Small synth beep
  function blip(freq=520, time=0.11){
    try {
      const ctx = new (window.AudioContext || window.webkitAudioContext)();
      const osc = ctx.createOscillator();
      const gain = ctx.createGain();
      osc.type = 'triangle';
      osc.frequency.value = freq;
      gain.gain.value = 0;
      osc.connect(gain);
      gain.connect(ctx.destination);

      const t = ctx.currentTime;
      gain.gain.linearRampToValueAtTime(0.07, t + 0.02);
      gain.gain.exponentialRampToValueAtTime(0.0001, t + time);
      osc.start(t);
      osc.stop(t + time + 0.04);
    } catch(e){
      // ignore audio errors
    }
  }

  // ---------- CONFETTI ----------
  const confetti = (function(){
    const canvas = confettiCanvas;
    const ctx = canvas.getContext('2d');
    let w = window.innerWidth;
    let h = window.innerHeight;
    let pieces = [];
    let active = false;

    function resize() {
      w = window.innerWidth;
      h = window.innerHeight;
      canvas.width = w * window.devicePixelRatio;
      canvas.height = h * window.devicePixelRatio;
      ctx.setTransform(window.devicePixelRatio,0,0,window.devicePixelRatio,0,0);
    }
    resize();
    window.addEventListener('resize', resize);

    function createPieces(count){
      pieces = [];
      for(let i = 0; i < count; i++){
        pieces.push({
          x: Math.random() * w,
          y: -20 - Math.random() * h/2,
          size: 4 + Math.random() * 6,
          speedY: 1 + Math.random() * 3,
          color: Math.random() < 0.5 ? '#ff5e7a' : '#46e6ff',
          tilt: Math.random() * 1,
          rot: Math.random() * Math.PI * 2,
        });
      }
    }

    function draw(){
      if(!active) return;
      ctx.clearRect(0,0,w,h);
      pieces.forEach(p => {
        p.y += p.speedY;
        p.rot += 0.04;
        p.x += Math.sin(p.rot) * 0.6;
        ctx.save();
        ctx.translate(p.x, p.y);
        ctx.rotate(p.rot);
        ctx.fillStyle = p.color;
        ctx.fillRect(-p.size/2, -p.size/2, p.size, p.size * 0.5);
        ctx.restore();
      });
      pieces = pieces.filter(p => p.y < h + 40);
      if(pieces.length === 0){
        active = false;
        ctx.clearRect(0,0,w,h);
        return;
      }
      requestAnimationFrame(draw);
    }

    function burst(){
      createPieces(80);
      active = true;
      draw();
    }

    return { burst };
  })();

  // ---------- SETUP EVENTS ----------
  onAll('.step','click',btn=>{
    const type = btn.dataset.step;
    const delta = parseInt(btn.dataset.delta,10);
    if(type === 'players'){
      playersCount = clamp(playersCount + delta, 3, 30);
      playersVal.textContent = playersCount;
      const rec = recommendImpostors(playersCount);
      if(impostors !== rec){
        impostors = rec;
        impsVal.textContent = impostors;
      }
    } else {
      impostors = clamp(impostors + delta, 1, Math.max(1, playersCount - 1));
      impsVal.textContent = impostors;
    }
    haptic(8);
    blip(320, .05);
  });

  goNamesBtn.addEventListener('click', () => {
    show('names');
    renderNames();
    haptic(12);
  });

  backSetupBtn.addEventListener('click', () => {
    show('setup');
    haptic(8);
  });

  startGameBtn.addEventListener('click', () => {
    players = [];
    for(let i = 0; i < playersCount; i++){
      const val = (qs(`#p_${i}`).value || '').trim();
      players.push(val || `–ò–≥—Ä–∞—á ${i+1}`);
    }
    beginRound();
  });

  againBtn.addEventListener('click', () => {
    beginRound(true);
  });

  toSetupBtn.addEventListener('click', () => {
    show('setup');
    haptic([10,40,10]);
  });

  function renderNames(){
    namesList.innerHTML = '';
    for(let i = 0; i < playersCount; i++){
      const row = document.createElement('div');
      row.className = 'name-row';

      const idx = document.createElement('div');
      idx.className = 'name-index';
      idx.textContent = (i+1) + '.';

      const input = document.createElement('input');
      input.className = 'input';
      input.placeholder = `–ò–≥—Ä–∞—á ${i+1}`;
      input.id = `p_${i}`;

      row.appendChild(idx);
      row.appendChild(input);
      namesList.appendChild(row);
    }
  }

  // ---------- ROUND FLOW ----------
  function beginRound(keepPlayers=false){
    if(!keepPlayers){
      // secretWord from WORDS
      secretWord = WORDS[(Math.random() * WORDS.length) | 0];
    }
    if(keepPlayers && !players.length){
      // safety: rebuild default players if somehow empty
      players = Array.from({length: playersCount}, (_,i)=>`–ò–≥—Ä–∞—á ${i+1}`);
    }
    if(!secretWord){
      secretWord = WORDS[(Math.random() * WORDS.length) | 0];
    }

    // impostor indexes
    impIdx = pickUnique(
      players.length,
      Math.min(impostors, Math.max(1, players.length - 1))
    );

    current = 0;
    buildDots();
    show('reveal');
    prepareCard();
    haptic([14,40,14]);
    blip(460, .09);
  }

  function buildDots(){
    dotsEl.innerHTML = '';
    for(let i = 0; i < players.length; i++){
      const d = document.createElement('div');
      d.className = 'dot';
      if(i === 0) d.classList.add('active');
      dotsEl.appendChild(d);
    }
  }

  function updateDots(){
    const dots = dotsEl.querySelectorAll('.dot');
    dots.forEach((d, i) => {
      d.classList.remove('active');
      if(i < current) d.classList.add('done');
    });
    if(dots[current]) dots[current].classList.add('active');
  }

  // ---------- CARD INTERACTION ----------
  let drag = {
    active:false,
    startY:0,
    prevY:0,
    vy:0,
    offset:0,
    peak:0,
    revealed:false
  };

  let maxDrop = 0;

  function measure(){
    const pr = panel.getBoundingClientRect();
    const cr = card.getBoundingClientRect();
    const wr = wrap.getBoundingClientRect();
    const target = pr.height + 16;
    const maxAllowed = Math.max(0, wr.height - cr.height - 18);
    maxDrop = Math.min(target, maxAllowed);
  }

  function prepareCard(){
    measure();
    drag.revealed = false;
    drag.offset = 0;
    drag.peak = 0;
    drag.vy = 0;
    setCardY(0, true);
    nextBtn.classList.remove('show');

    pname.textContent = players[current];
    const isImp = impIdx.includes(current);
    wordEl.textContent = isImp ? '–¢–∏ —Å–∏ –ò–ú–ü–û–°–¢–™–†!' : secretWord;
    wordEl.style.color = isImp ? '#ffebf0' : '#ffffff';

    card.style.borderColor = 'rgba(255,255,255,.96)';
    card.style.boxShadow = '0 22px 60px rgba(0,0,0,.75)';

    updateDots();
  }

  function setCardY(px, noTilt){
    const tilt = noTilt ? 0 : Math.min(10, px / 22);
    const scale = 1 - Math.min(0.03, px / 1200);
    card.style.transform = `translateY(${px}px) rotateX(${tilt}deg) scale(${scale})`;
  }

  function springTo(target, v0 = 0){
    let y = getCurrentY();
    let v = v0;
    const stiffness = 420;
    const damping = 20;
    const dt = 1 / 60;

    function step(){
      const a = -stiffness * (y - target) - damping * v;
      v += a * dt;
      y += v * dt;
      setCardY(y, false);
      if(Math.abs(y - target) < 0.5 && Math.abs(v) < 0.5){
        setCardY(target, true);
        return;
      }
      requestAnimationFrame(step);
    }
    requestAnimationFrame(step);
  }

  function getCurrentY(){
    const m = (card.style.transform || '').match(/translateY\((-?\d+\.?\d*)px\)/);
    return m ? parseFloat(m[1]) : 0;
  }

  card.addEventListener('pointerdown', e => {
    card.setPointerCapture(e.pointerId);
    drag.active = true;
    drag.startY = e.clientY;
    drag.prevY = e.clientY;
    drag.vy = 0;
  });

  card.addEventListener('pointermove', e => {
    if(!drag.active) return;
    const y = e.clientY;
    const dy = y - drag.prevY;
    drag.prevY = y;
    drag.vy = 0.65 * drag.vy + 0.35 * dy;

    let next = clamp(drag.offset + dy, 0, maxDrop + 32);
    drag.offset = next;
    if(next > drag.peak) drag.peak = next;

    const eased = next <= maxDrop ? next : maxDrop + (next - maxDrop) * 0.25;
    setCardY(eased, false);
  });

  card.addEventListener('pointerup', release);
  card.addEventListener('pointercancel', release);

  function release(){
    if(!drag.active) return;
    drag.active = false;
    const threshold = maxDrop * 0.88;
    const ok = drag.peak >= threshold;

    haptic(16);

    if(ok && !drag.revealed){
      drag.revealed = true;
      nextBtn.classList.add('show');
      // glow
      card.style.boxShadow = '0 30px 90px rgba(0,0,0,.9)';
      card.style.borderColor = 'rgba(255,255,255,1)';
      blip(640, .13);
      haptic([20,40,30]);
    } else {
      blip(260, .06);
    }

    const bounceV = -drag.vy * 0.9;
    drag.offset = 0;
    drag.peak = 0;
    springTo(0, bounceV);
  }

  // Keyboard accessibility
  card.addEventListener('keydown', e => {
    if((e.key === 'Enter' || e.key === ' ') && !drag.revealed){
      e.preventDefault();
      drag.revealed = true;
      nextBtn.classList.add('show');
      haptic([16,50,16]);
      blip(540, .12);
      springTo(0, -18);
      card.style.boxShadow = '0 30px 90px rgba(0,0,0,.9)';
      card.style.borderColor = 'rgba(255,255,255,1)';
    }
  });

  // Next player / finish
  nextBtn.addEventListener('click', () => {
    if(current + 1 >= players.length){
      show('end');
      nextBtn.classList.remove('show');
      confetti.burst();
      haptic([24,40,24,40,24]);
      blip(720, .16);
    } else {
      current++;
      prepareCard();
      haptic(14);
      blip(420, .08);
    }
  });

  // ---------- INIT ----------
  renderNames();

</script>
</body>
</html>
