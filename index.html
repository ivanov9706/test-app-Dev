<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <meta name="theme-color" content="#0f1014" />
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <title>Impostor — Swipe Down (2025 v3)</title>
  <style>
    :root{
      --bg1:#0f1014; --bg2:#161921; --accent:#ff6b4a; --accent-2:#ffd06b; --white:#fff; --muted: rgba(255,255,255,.85);
      --panel:#1a1f2a;               /* lighter bluish panel for contrast */
      --panel-border: rgba(255,255,255,.12);
      --radius: 24px; --cardRadius: 22px;
      --shadow-lg: 0 22px 68px rgba(0,0,0,.45);
      --shadow-md: 0 14px 40px rgba(0,0,0,.34);
      --safe-bottom: env(safe-area-inset-bottom);
      --safe-top: env(safe-area-inset-top);
      --panelHeight: clamp(280px, 34vh, 320px); /* tighter */
      --dragGap: 12px;
    }

    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:#0f1014}
    body{
      font-family: ui-sans-serif, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, "Noto Sans", sans-serif;
      -webkit-font-smoothing: antialiased; -webkit-text-size-adjust: 100%; color: var(--white);
      background: linear-gradient(160deg,var(--bg1),var(--bg2)); overflow:hidden;
    }
    /* Cover notch */
    body::before{content:"";position:fixed;left:0;right:0;top:0;height:env(safe-area-inset-top);background:linear-gradient(160deg,var(--bg1),var(--bg2));z-index:9999;}

    .noise{position:fixed;inset:-50%;pointer-events:none;opacity:.08;mix-blend-mode:overlay;background-image:url('data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200"><filter id="n"><feTurbulence type="fractalNoise" baseFrequency="0.8" numOctaves="2"/><feColorMatrix type="saturate" values="0"/></filter><rect width="100%" height="100%" filter="url(%23n)"/></svg>');animation:grain 1.8s steps(4) infinite}
    @keyframes grain{0%{transform:translate(0,0)}25%{transform:translate(-3%,2%)}50%{transform:translate(4%,-3%)}75%{transform:translate(-2%,-1%)}100%{transform:translate(0,0)}}
    .grid{position:fixed;inset:0;pointer-events:none;opacity:.05;background-image:radial-gradient(circle at 50% 50%, rgba(255,255,255,.35) 0 1px, transparent 2px), linear-gradient(transparent 31px, rgba(255,255,255,.08) 32px), linear-gradient(90deg, transparent 31px, rgba(255,255,255,.08) 32px); background-size:32px 32px, 32px 32px, 32px 32px;}

    .container{ max-width:620px; margin:0 auto; height:100%; display:grid; grid-template-rows:auto 1fr auto; padding:calc(14px + var(--safe-top)) 14px calc(26px + var(--safe-bottom)); gap:8px; }
    .topbar{ display:flex; align-items:center; justify-content:center; padding:4px 0 0; }
    .logo{ font-weight:900; letter-spacing:1px; font-size:17px; text-transform:uppercase; background:linear-gradient(90deg,var(--accent),var(--accent-2)); -webkit-background-clip:text; background-clip:text; color:transparent; filter: drop-shadow(0 6px 18px rgba(255,107,74,.3)); }

    .screen{ display:none; animation:fade .24s ease; }
    .screen.active{ display:block; }
    @keyframes fade{ from{ opacity:0; transform:translateY(6px) scale(.995);} to{ opacity:1; transform:none; } }

    .block{ background: linear-gradient( to bottom right, rgba(255,255,255,.06), rgba(255,255,255,.02) ); border:1px solid rgba(255,255,255,.14); border-radius:18px; padding:14px; box-shadow: var(--shadow-md); backdrop-filter: blur(8px); }
    .center{text-align:center}
    .hint{ color:var(--muted); text-align:center; margin:8px 0 0; }
    .controls{ display:flex; gap:10px; align-items:center; justify-content:center; margin:8px 0; }
    .step{ width:48px; height:48px; border-radius:14px; border:none; background:rgba(255,255,255,.08); color:#fff; font-weight:900; font-size:22px; cursor:pointer; transition: transform .06s ease; }
    .step:active{ transform: translateY(1px) scale(.99); }
    .value{ min-width:96px; height:48px; border-radius:14px; background:rgba(0,0,0,.28); display:flex; align-items:center; justify-content:center; font-weight:900; font-size:18px; border:1px solid rgba(255,255,255,.16); }
    .primary{ appearance:none; border:none; border-radius:999px; background:linear-gradient(180deg,#111318,#0b0d12); color:#fff; padding:12px 18px; font-weight:800; cursor:pointer; box-shadow:0 10px 32px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); }

    .names{ display:flex; flex-direction:column; gap:8px; margin-top:6px; max-height:58vh; overflow:auto; padding-right:6px; }
    .input{ width:100%; padding:12px 12px; border-radius:12px; border:1px solid rgba(255,255,255,.16); background:rgba(0,0,0,.28); color:#fff; outline:none; font-weight:600; }

    .reveal-wrap{ position:relative; height:70vh; max-height:700px; min-height:520px; margin:4px auto 8px; overflow:visible; }

    /* Role field (flat bottom, better contrast) */
    .word-panel{ position:absolute; left:0; right:0; top:0; height:var(--panelHeight); background: var(--panel); box-shadow: var(--shadow-lg); display:flex; align-items:center; justify-content:center; padding:18px 20px; z-index:1; border-radius: 22px 22px 0 0; border:1px solid var(--panel-border); overflow:hidden; }
    .word-panel::before{ content:""; position:absolute; inset:0; background-image: radial-gradient(900px 300px at 50% 0, rgba(255,255,255,.07), transparent 60%), linear-gradient(180deg, rgba(255,255,255,.06), transparent 35%); pointer-events:none; }
    .word-panel h1{ margin:0; font-size: clamp(26px, 6.2vw, 50px); letter-spacing: 1.8px; font-weight: 900; text-align:center; }

    /* Card (smaller + animated) */
    .card{ position:absolute; left:0; right:0; top:0; height:clamp(320px, 48vh, 380px); border-radius: var(--cardRadius); overflow:hidden; z-index:2; touch-action:none; cursor:grab; will-change: transform, filter; border: 1px solid rgba(255,255,255,.14); box-shadow: var(--shadow-lg); background:linear-gradient(180deg,#ffb869,#ff7a43); }
    .card:active{ cursor:grabbing; }
    .card::after{ content:""; position:absolute; inset:0; background: linear-gradient( to bottom, rgba(255,255,255,.14), transparent 35% ); mix-blend-mode: soft-light; pointer-events:none; }

    .card-inner{ position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:flex-end; padding:18px; text-align:center; }
    .player-name{ position:absolute; left:0; right:0; top:22px; text-align:center; font-weight:1000; font-size: clamp(24px, 7vw, 44px); text-shadow: 0 6px 22px rgba(0,0,0,.35); letter-spacing:.5px; }
    .avatar{ position:absolute; left:0; right:0; bottom:84px; margin:0 auto; width: 232px; height: 188px; border-radius: 22px; background: radial-gradient( circle at 46% 36%, #ffd9ab 0%, #f3a064 42%, #e2683f 86% ); opacity:.96; box-shadow: inset 0 -22px 40px rgba(0,0,0,.16), 0 18px 38px rgba(0,0,0,.28); border:1px solid rgba(0,0,0,.18); display:flex; align-items:center; justify-content:center; font-size:56px; }

    .hint-row{ font-weight:850; font-size:15px; color:#fff; text-shadow:0 3px 10px rgba(0,0,0,.2); display:flex; flex-direction:column; align-items:center; gap:6px; margin-top:auto; margin-bottom:4px; opacity:.98; }
    .hint-row .tiny{ font-size:12px; opacity:.9; letter-spacing:.2px; }

    .footer{ display:flex; flex-direction:column; align-items:center; gap:8px }
    .btn{ appearance:none; border:none; border-radius:999px; background:linear-gradient(180deg,#111318,#0b0d12); color:#fff; padding:14px 18px; font-weight:900; cursor:pointer; box-shadow:0 10px 32px rgba(0,0,0,.35), inset 0 1px 0 rgba(255,255,255,.08); border:1px solid rgba(255,255,255,.12); display:none; }
    .btn.show{ display:inline-block; animation:pop .18s ease; }
    @keyframes pop{ from{ transform:scale(.96); opacity:0;} to{ transform:none; opacity:1;} }
    .pass{ color:var(--muted) }

    .rail{ display:flex; gap:6px; justify-content:center; margin-top:4px; }
    .dot{ width:8px; height:8px; border-radius:999px; background:rgba(255,255,255,.26); }
    .dot.active{ background:linear-gradient(180deg,var(--accent-2),var(--accent)); box-shadow:0 0 10px rgba(255,160,64,.45); }

    .kudos{ font-weight:1000; font-size:22px; margin:6px 0 2px; text-align:center; }
    .row{ display:flex; gap:8px; justify-content:center; align-items:center; margin-top:6px }

    :focus-visible{ outline:2px solid var(--accent-2); outline-offset:3px }

    /* Slide transition classes */
    .slide-enter{ transform: translateX(110%); opacity:0; }
    .slide-enter-active{ transition: transform .28s ease, opacity .28s ease; transform: translateX(0); opacity:1; }
    .slide-exit{ transform: translateX(0); opacity:1; }
    .slide-exit-active{ transition: transform .24s ease, opacity .24s ease; transform: translateX(-110%); opacity:0; }
  </style>
</head>
<body>
  <div class="noise"></div>
  <div class="grid"></div>

  <div class="container">
    <div class="topbar"><div class="logo">Impostor</div></div>

    <!-- SETUP -->
    <section id="setup" class="screen active">
      <div class="block center">
        <h3 style="margin:6px 0 8px">New Game</h3>
        <div>Players</div>
        <div class="controls">
          <button class="step" data-step="players" data-delta="-1">–</button>
          <div id="playersVal" class="value">3</div>
          <button class="step" data-step="players" data-delta="1">+</button>
        </div>
        <div style="margin-top:6px">Impostors</div>
        <div class="controls">
          <button class="step" data-step="imps" data-delta="-1">–</button>
          <div id="impsVal" class="value">1</div>
          <button class="step" data-step="imps" data-delta="1">+</button>
        </div>
        <p class="hint">Recommendation adjusts with player count — you can tweak it.</p>
        <button id="goNames" class="primary">Continue</button>
      </div>
    </section>

    <!-- NAMES -->
    <section id="names" class="screen">
      <div class="block">
        <h3 class="center" style="margin:6px 0 10px">Player Names</h3>
        <div id="namesList" class="names"></div>
        <div class="row">
          <button id="startGame" class="primary">Start</button>
          <button id="backSetup" class="primary" style="background:#16181f">Back</button>
        </div>
        <p class="hint">Leave blanks for default names.</p>
      </div>
    </section>

    <!-- REVEAL -->
    <section id="reveal" class="screen" aria-label="Swipe down to reveal">
      <div class="reveal-wrap" id="wrap">
        <div id="panel" class="word-panel"><h1 id="word">WORD</h1></div>
        <div id="card" class="card" role="button" aria-label="Swipe down to reveal your word" tabindex="0">
          <div class="card-inner">
            <div class="player-name" id="pname">Player</div>
            <div class="avatar" id="avatar" aria-hidden="true">🙂</div>
            <div class="hint-row">
              <div>Swipe down to reveal</div>
              <div class="tiny">(Tap SPACE/ENTER also works)</div>
            </div>
          </div>
        </div>
        <canvas id="confetti" style="position:absolute;inset:0;pointer-events:none"></canvas>
      </div>
      <div class="footer">
        <div class="rail" id="rail"></div>
        <button id="next" class="btn">Next Player</button>
        <div class="pass">Pass device to the next player</div>
      </div>
    </section>

    <!-- END -->
    <section id="end" class="screen">
      <div class="kudos">Everyone saw their roles 🎉</div>
      <p class="hint">Start another round or change players.</p>
      <div class="row">
        <button id="again" class="primary">New Round (same players)</button>
        <button id="toSetup" class="primary" style="background:#16181f">Setup</button>
      </div>
    </section>
  </div>

  <script>
    /* Words */
    const WORDS = ["Volcano","Umbrella","Backpack","Lighthouse","Lantern","Mirror","Telescope","Pancakes","Compass","Rocket"];

    /* Palettes per card (slides in with new color) */
    const PALETTES = [
      ['#ffb869','#ff7a43'],   // orange
      ['#6bdcff','#3c9cff'],   // sky -> blue
      ['#a3ff8f','#3bd179'],   // lime -> green
      ['#ff92d1','#ff5f84'],   // pink -> rose
      ['#ffd06b','#ff9c3b'],   // gold -> amber
      ['#c9b7ff','#7e6bff']    // lavender -> indigo
    ];

    /* State */
    let playersCount = 3; let impostors = 1; let players = []; let secretWord = ""; let impIdx = []; let current = 0;

    /* Elements */
    const screens = mapEls('#setup','#names','#reveal','#end');
    const playersVal = qs('#playersVal'), impsVal = qs('#impsVal');
    const goNamesBtn = qs('#goNames'), startGameBtn = qs('#startGame'), backSetupBtn = qs('#backSetup');
    const namesList = qs('#namesList');
    const wrap = qs('#wrap'), card = qs('#card'), panel = qs('#panel');
    const pname = qs('#pname'), wordEl = qs('#word'), nextBtn = qs('#next');
    const againBtn = qs('#again'), toSetupBtn = qs('#toSetup');
    const rail = qs('#rail');
    const confetti = qs('#confetti');
    const avatar = qs('#avatar');

    /* Controls */
    onAll('.step','click',(btn)=>{
      const type = btn.dataset.step, delta = parseInt(btn.dataset.delta,10);
      if(type==='players'){
        playersCount = clamp(playersCount+delta,3,30); playersVal.textContent = playersCount;
        const rec = recommendImpostors(playersCount); if(impostors!==rec){ impostors=rec; impsVal.textContent=impostors; }
      }else{ impostors = clamp(impostors+delta,1,Math.max(1,playersCount-1)); impsVal.textContent = impostors; }
      haptic(6);
    });

    goNamesBtn.addEventListener('click', ()=>{
      show('names'); namesList.innerHTML='';
      for(let i=0;i<playersCount;i++){ const div=document.createElement('div'); const inp=document.createElement('input'); inp.className='input'; inp.placeholder=`Player ${i+1}`; inp.id=`p_${i}`; div.appendChild(inp); namesList.appendChild(div); }
    });

    backSetupBtn.addEventListener('click', ()=> show('setup'));

    startGameBtn.addEventListener('click', ()=>{
      players=[]; for(let i=0;i<playersCount;i++){ const v=(qs(`#p_${i}`).value||'').trim(); players.push(v || `Player ${i+1}`); }
      beginRound();
    });

    /* Round */
    function beginRound(){
      secretWord = WORDS[(Math.random()*WORDS.length)|0];
      impIdx = pickUnique(players.length, Math.min(impostors, Math.max(1, players.length-1)));
      current = 0; buildRail(); show('reveal'); prepareCard(true); sizeConfetti();
    }

    function buildRail(){ rail.innerHTML=''; for(let i=0;i<players.length;i++){ const d=document.createElement('div'); d.className='dot'+(i===0?' active':''); rail.appendChild(d);} }

    /* Reveal drag */
    let drag = {active:false, prevY:0, vy:0, offset:0, peak:0, revealed:false};
    let maxDrop = 0;

    function pxVar(name){ const v = getComputedStyle(document.documentElement).getPropertyValue(name).trim(); return parseFloat(v.replace('px','')) || 0; }
    function measure(){ const panelRect = panel.getBoundingClientRect(); const cardRect = card.getBoundingClientRect(); const wrapRect = wrap.getBoundingClientRect(); const gap = pxVar('--dragGap'); let target = panelRect.height + gap; const maxAllowed = Math.max(0, wrapRect.height - cardRect.height - 12); maxDrop = Math.min(target, maxAllowed); }

    function setCardPalette(i){ const pal = PALETTES[i % PALETTES.length]; card.style.background = `linear-gradient(180deg, ${pal[0]}, ${pal[1]})`; }

    function prepareCard(initial){
      measure(); drag.revealed=false; drag.offset=0; drag.peak=0; setY(0); nextBtn.classList.remove('show');
      pname.textContent = players[current]; avatar.textContent = randEmoji();
      const isImp = impIdx.includes(current); wordEl.textContent = isImp ? "You are the Impostor!" : secretWord; Array.from(rail.children).forEach((d,i)=>d.classList.toggle('active', i===current));
      setCardPalette(current);
      if(!initial){ // slide-in
        card.classList.remove('slide-exit','slide-exit-active');
        card.classList.add('slide-enter'); requestAnimationFrame(()=>{ card.classList.add('slide-enter-active'); });
        setTimeout(()=>{ card.classList.remove('slide-enter','slide-enter-active'); }, 300);
      }
    }

    function setY(px){ card.style.transform = `translateY(${px}px)`; }
    function springTo(target,{stiffness=560,damping=18,v0=0}={}){ let y = parseFloat((card.style.transform||'').match(/-?\d+\.?\d*/)?.[0] || 0); let v = v0; const dt = 1/60; function step(){ const a = -stiffness*(y-target) - damping*v; v += a*dt; y += v*dt; card.style.transform = `translateY(${y}px)`; if (Math.abs(y-target) < 0.6 && Math.abs(v) < 0.6){ card.style.transform = `translateY(${target}px)`; return; } requestAnimationFrame(step);} requestAnimationFrame(step); }

    function haptic(n){ if(navigator.vibrate) navigator.vibrate(n); }
    function blip(freq=560,time=.12){ try{ const ctx=new (window.AudioContext||window.webkitAudioContext)(); const o=ctx.createOscillator(), g=ctx.createGain(); o.type='triangle'; o.frequency.value=freq; g.gain.value=0; o.connect(g); g.connect(ctx.destination); const t=ctx.currentTime; g.gain.linearRampToValueAtTime(.06,t+.01); g.gain.exponentialRampToValueAtTime(.0001,t+time); o.start(t); o.stop(t+time+.02);}catch(e){} }

    card.addEventListener('pointerdown', (e)=>{ card.setPointerCapture(e.pointerId); drag.active=true; drag.prevY=e.clientY; drag.vy=0; });
    card.addEventListener('pointermove', (e)=>{ if(!drag.active) return; const y=e.clientY; const dy=y-drag.prevY; drag.prevY=y; drag.vy = 0.7*drag.vy + 0.3*dy; let newOffset = Math.max(0, Math.min(maxDrop, drag.offset + dy)); drag.offset = newOffset; if(newOffset>drag.peak) drag.peak = newOffset; setY(newOffset); });
    card.addEventListener('pointerup', release); card.addEventListener('pointercancel', release);

    function release(){ if(!drag.active) return; drag.active=false; const pulledEnough = drag.peak >= maxDrop*0.95; haptic(8); springTo(0,{stiffness:560,damping:18,v0:-drag.vy*0.9}); drag.offset=0; if(pulledEnough && !drag.revealed){ drag.revealed=true; nextBtn.classList.add('show'); haptic([16,60,16]); blip(620,.10); confettiBurst(); } }

    card.addEventListener('keydown', (e)=>{ if((e.key==='Enter'||e.key===' ') && !drag.revealed){ e.preventDefault(); drag.revealed=true; nextBtn.classList.add('show'); haptic([16,60,16]); blip(); springTo(0,{stiffness:560,damping:18}); confettiBurst(); } });

    nextBtn.addEventListener('click', ()=>{
      if(current+1>=players.length){ show('end'); }
      else{
        // exit current to left
        card.classList.remove('slide-enter','slide-enter-active');
        card.classList.add('slide-exit'); requestAnimationFrame(()=>{ card.classList.add('slide-exit-active'); });
        setTimeout(()=>{ current++; prepareCard(false); }, 240);
      }
    });

    /* Confetti */
    let ctx, W, H, parts=[]; function sizeConfetti(){ confetti.width = W = wrap.clientWidth; confetti.height = H = wrap.clientHeight; ctx = confetti.getContext('2d'); }
    window.addEventListener('resize', sizeConfetti, {passive:true});
    function confettiBurst(){ sizeConfetti(); parts = Array.from({length:64}, ()=>({ x: W/2 + (Math.random()*120-60), y: (Math.random()*40)+40, vx: (Math.random()*2-1)*4, vy: Math.random()*-3-2, g: .18 + Math.random()*.06, r: Math.random()*6+2, a: 1, spin: Math.random()*6 })); let t=0; (function loop(){ t++; ctx.clearRect(0,0,W,H); for(const p of parts){ p.vy += p.g; p.x += p.vx; p.y += p.vy; p.spin += .2; p.a -= .010; ctx.save(); ctx.globalAlpha=Math.max(0,p.a); ctx.translate(p.x,p.y); ctx.rotate(p.spin); const grd = ctx.createLinearGradient(-p.r,-p.r,p.r,p.r); grd.addColorStop(0,'#ffd06b'); grd.addColorStop(1,'#ff6b4a'); ctx.fillStyle=grd; ctx.fillRect(-p.r,-p.r,p.r*2,p.r*2); ctx.restore(); } if(t<200) requestAnimationFrame(loop); })(); }

    againBtn.addEventListener('click', ()=> beginRound());
    toSetupBtn.addEventListener('click', ()=> show('setup'));

    /* Utils */
    function show(key){ Object.values(screens).forEach(s=>s.classList.remove('active')); screens[key].classList.add('active'); }
    function qs(sel){ return document.querySelector(sel); }
    function mapEls(...sel){ const o={}; sel.forEach(s=>o[s.slice(1)]=qs(s)); return o; }
    function onAll(sel,ev,cb){ document.querySelectorAll(sel).forEach(n=>n.addEventListener(ev,()=>cb(n))); }
    function clamp(v,a,b){ return Math.max(a, Math.min(b, v)); }
    function recommendImpostors(n){ if(n<=6)return 1; if(n<=10)return 2; if(n<=14)return 3; if(n<=18)return 4; return Math.floor(n/4); }
    function pickUnique(n,k){ const arr=Array.from({length:n},(_,i)=>i); for(let i=arr.length-1;i>0;i--){const j=(Math.random()*(i+1))|0; [arr[i],arr[j]]=[arr[j],arr[i]];} return arr.slice(0,k).sort((a,b)=>a-b); }
    function randEmoji(){ const s = ['🙂','😎','🤖','👽','🧠','🦊','🐼','🐵','🐯','🦄','🐸','🐙','🦖','🐺','🦁','🐨']; return s[(Math.random()*s.length)|0]; }

    new ResizeObserver(()=>measure()).observe(wrap);
  </script>
</body>
</html>
